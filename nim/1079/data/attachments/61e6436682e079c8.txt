2026-02-14 04:33:07.552 DEBUG [tests.conftest] Running fixture setup: test_id
2026-02-14 04:33:07.553 DEBUG [tests.conftest] Running test: test_filter_works_with_auto_sharding with id: 2026-02-14_04-33-07__1306c52b-75bb-4dd9-8dd0-b52dd9309bd4
2026-02-14 04:33:07.553 DEBUG [src.steps.common] Running fixture setup: common_setup
2026-02-14 04:33:07.555 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2026-02-14 04:33:07.555 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2026-02-14 04:33:07.566 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-14 04:33:07.566 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2026-02-14_04-33-07__1306c52b-75bb-4dd9-8dd0-b52dd9309bd4__wakuorg_nwaku:latest.log
2026-02-14 04:33:07.566 DEBUG [src.node.waku_node] Starting Node...
2026-02-14 04:33:07.566 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-14 04:33:07.568 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-14 04:33:07.568 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.116.104
2026-02-14 04:33:07.568 DEBUG [src.node.docker_mananger] Generated ports ['45130', '45131', '45132', '45133', '45134']
2026-02-14 04:33:07.568 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-14 04:33:07.569 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-14 04:33:07.569 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-14 04:33:07.569 DEBUG [src.node.waku_node] Using volumes []
2026-02-14 04:33:07.569 DEBUG [src.node.docker_mananger] docker run -i -t -p 45130:45130 -p 45131:45131 -p 45132:45132 -p 45133:45133 -p 45134:45134 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=45132 --rest-port=45130 --tcp-port=45131 --discv5-udp-port=45133 --rest-address=0.0.0.0 --nat=extip:172.18.116.104 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=0f7fd99dd5b275cbbb88ef552dcd487dd0980dabec1044e53864f44d12aaef50 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=45134 --metrics-logging=true --relay=true --filter=true --content-topic=/myapp/1/latest/proto --num-shards-in-network=1
2026-02-14 04:33:07.772 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.116.104 waku f8029d4c4bb193ae9e5c5095e651db2703220687988469fcc24351aaacd02ee1
2026-02-14 04:33:07.820 DEBUG [src.node.docker_mananger] Container started with ID f8029d4c4bb1. Setting up logs at ./log/docker/node1_2026-02-14_04-33-07__1306c52b-75bb-4dd9-8dd0-b52dd9309bd4__wakuorg_nwaku:latest.log
2026-02-14 04:33:07.821 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 45130
2026-02-14 04:33:07.821 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-14 04:33:07.856 ERROR [src.node.docker_mananger] Max retries reached for container 1da730c26b52. Exiting log stream.
2026-02-14 04:33:08.100 ERROR [src.node.docker_mananger] Max retries reached for container 1764d8dee3f3. Exiting log stream.
2026-02-14 04:33:08.373 ERROR [src.node.docker_mananger] Max retries reached for container 7ac39834df75. Exiting log stream.
2026-02-14 04:33:08.823 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45130/health" -H "Content-Type: application/json" -d 'None'
2026-02-14 04:33:08.826 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","connectionStatus":"Disconnected","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_READY","desc":"Relay is not ready, filter will not be able to sort out messages"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"NOT_READY","desc":"No Filter service peer available yet"},{"Rln Relay":"NOT_MOUNTED"}]}'
2026-02-14 04:33:08.826 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-14 04:33:08.826 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:45130/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-14 04:33:08.829 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.116.104/tcp/45131/p2p/16Uiu2HAkzPKAkHFZ1sRjnR13LdVrWaQSnw2GaBDn7X5CFS18DJqS","/ip4/172.18.116.104/tcp/45132/ws/p2p/16Uiu2HAkzPKAkHFZ1sRjnR13LdVrWaQSnw2GaBDn7X5CFS18DJqS"],"enrUri":"enr:-L24QAMr7g_kngALJVNJNK_9UHWwWGpUngrlPufdYuo8jqu2Fti3kgACa_mQoKz24FIiiDvEx__BfxCdcBAhBdndXj8CgmlkgnY0gmlwhKwSdGiKbXVsdGlhZGRyc5YACASsEnRoBrBLAAoErBJ0aAawTN0DgnJzhQACAQAAiXNlY3AyNTZrMaECSa-95P2lBfJbniSbbpruGdd95Id6mk8CDF0Y5I_Kue2DdGNwgrBLg3VkcIKwTYV3YWt1MgU"}'
2026-02-14 04:33:08.829 INFO [src.node.waku_node] REST service is ready !!
2026-02-14 04:33:08.836 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-14 04:33:08.836 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2026-02-14_04-33-07__1306c52b-75bb-4dd9-8dd0-b52dd9309bd4__wakuorg_nwaku:latest.log
2026-02-14 04:33:08.836 DEBUG [src.node.waku_node] Starting Node...
2026-02-14 04:33:08.836 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-14 04:33:08.838 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-14 04:33:08.838 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.229.167
2026-02-14 04:33:08.838 DEBUG [src.node.docker_mananger] Generated ports ['57779', '57780', '57781', '57782', '57783']
2026-02-14 04:33:08.838 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-14 04:33:08.838 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-14 04:33:08.838 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-14 04:33:08.839 DEBUG [src.node.waku_node] Using volumes []
2026-02-14 04:33:08.839 DEBUG [src.node.docker_mananger] docker run -i -t -p 57779:57779 -p 57780:57780 -p 57781:57781 -p 57782:57782 -p 57783:57783 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=57781 --rest-port=57779 --tcp-port=57780 --discv5-udp-port=57782 --rest-address=0.0.0.0 --nat=extip:172.18.229.167 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=3fdff08a58cffbc73f03ea9fbcffcdcbbdfb252f71aa1dca5565ee9ea2fb4ca8 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=57783 --metrics-logging=true --relay=false --discv5-bootstrap-node=enr:-L24QAMr7g_kngALJVNJNK_9UHWwWGpUngrlPufdYuo8jqu2Fti3kgACa_mQoKz24FIiiDvEx__BfxCdcBAhBdndXj8CgmlkgnY0gmlwhKwSdGiKbXVsdGlhZGRyc5YACASsEnRoBrBLAAoErBJ0aAawTN0DgnJzhQACAQAAiXNlY3AyNTZrMaECSa-95P2lBfJbniSbbpruGdd95Id6mk8CDF0Y5I_Kue2DdGNwgrBLg3VkcIKwTYV3YWt1MgU --filternode=/ip4/172.18.116.104/tcp/45131/p2p/16Uiu2HAkzPKAkHFZ1sRjnR13LdVrWaQSnw2GaBDn7X5CFS18DJqS --content-topic=/myapp/1/latest/proto
2026-02-14 04:33:09.036 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.229.167 waku 0d6986fe1ee7405dec694c8086b45dfa6757ce42427d042f8fa67d304316b67f
2026-02-14 04:33:09.083 DEBUG [src.node.docker_mananger] Container started with ID 0d6986fe1ee7. Setting up logs at ./log/docker/node2_2026-02-14_04-33-07__1306c52b-75bb-4dd9-8dd0-b52dd9309bd4__wakuorg_nwaku:latest.log
2026-02-14 04:33:09.083 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 57779
2026-02-14 04:33:09.084 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-14 04:33:10.085 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:57779/health" -H "Content-Type: application/json" -d 'None'
2026-02-14 04:33:10.088 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","connectionStatus":"Disconnected","protocolsHealth":[{"Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_MOUNTED"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"NOT_READY","desc":"No Filter service peer available yet"},{"Rln Relay":"NOT_MOUNTED"}]}'
2026-02-14 04:33:10.088 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-14 04:33:10.088 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:57779/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-14 04:33:10.090 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.229.167/tcp/57780/p2p/16Uiu2HAm1w2C8fsDNWkMUYPmA4cEpPvDVneUn72yWKaYWDEuRPU6","/ip4/172.18.229.167/tcp/57781/ws/p2p/16Uiu2HAm1w2C8fsDNWkMUYPmA4cEpPvDVneUn72yWKaYWDEuRPU6"],"enrUri":"enr:-L24QGT0qSUVFOod1NXYsNVckWIVT6nrX_730af0AvW--6nRDvmfaX-wjqA6ZLd6g2BxF3FKnXXVTVuN8mdFp_oELFQCgmlkgnY0gmlwhKwS5aeKbXVsdGlhZGRyc5YACASsEuWnBuG0AAoErBLlpwbhtd0DgnJzhQACAQAAiXNlY3AyNTZrMaECYKrR1KyqWuJne4FXRDaatxaTFvgJVxGHWPnlt16g_9uDdGNwguG0g3VkcILhtoV3YWt1MgA"}'
2026-02-14 04:33:10.090 INFO [src.node.waku_node] REST service is ready !!
2026-02-14 04:33:10.091 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:57779/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.116.104/tcp/45131/p2p/16Uiu2HAkzPKAkHFZ1sRjnR13LdVrWaQSnw2GaBDn7X5CFS18DJqS"]'
2026-02-14 04:33:10.126 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-14 04:33:10.127 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:45130/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/myapp/1/latest/proto"]'
2026-02-14 04:33:10.148 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-14 04:33:10.150 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:57779/filter/v2/subscriptions" -H "Content-Type: application/json" -d '{"requestId": "69ec34b7-074f-45f8-99a6-04549466f2cd", "contentFilters": ["/myapp/1/latest/proto"], "pubsubTopic": "/waku/2/rs/2/0"}'
2026-02-14 04:33:10.165 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"requestId":"69ec34b7-074f-45f8-99a6-04549466f2cd","statusDesc":"OK"}'
2026-02-14 04:33:10.165 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:45130/relay/v1/auto/messages" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2026-02-14 04:33:10.172 ERROR [src.node.api_clients.base_client] HTTP error occurred: 400 Client Error: Bad Request for url: http://127.0.0.1:45130/relay/v1/auto/messages. Response content: b'Failed to publish: publish failed in relay: NoPeersToPublish'
2026-02-14 04:33:10.208 DEBUG [tests.conftest] Running fixture teardown: test_setup
2026-02-14 04:33:10.209 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2026-02-14 04:33:10.209 DEBUG [src.node.waku_node] Stopping container with id f8029d4c4bb1
2026-02-14 04:33:10.450 DEBUG [src.node.waku_node] Container stopped.
2026-02-14 04:33:10.450 DEBUG [src.node.waku_node] Stopping container with id 0d6986fe1ee7
2026-02-14 04:33:10.698 DEBUG [src.node.waku_node] Container stopped.
2026-02-14 04:33:10.699 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2026-02-14 04:33:10.708 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2026-02-14 04:33:10.713 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2026-02-14 04:33:10.716 DEBUG [tests.conftest] Running fixture teardown: attach_logs_on_fail
2026-02-14 04:33:10.716 DEBUG [tests.conftest] Test failed, attempting to attach logs to the allure reports
2026-02-14 04:33:10.717 DEBUG [src.libs.common] Attaching file ./log/docker/node1_2026-02-14_04-33-07__1306c52b-75bb-4dd9-8dd0-b52dd9309bd4__wakuorg_nwaku:latest.log
2026-02-14 04:33:10.721 DEBUG [src.libs.common] Attaching file ./log/docker/node2_2026-02-14_04-33-07__1306c52b-75bb-4dd9-8dd0-b52dd9309bd4__wakuorg_nwaku:latest.log
