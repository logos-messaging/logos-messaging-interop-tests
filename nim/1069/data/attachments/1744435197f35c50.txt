2026-02-04 17:13:57.613 DEBUG [tests.conftest] Running fixture setup: test_id
2026-02-04 17:13:57.614 DEBUG [tests.conftest] Running test: test_node_uses_both_auto_and_regular_apis with id: 2026-02-04_17-13-57__6b0f7671-a7e5-4bbd-82a4-8b47d0bc258d
2026-02-04 17:13:57.614 DEBUG [src.steps.common] Running fixture setup: common_setup
2026-02-04 17:13:57.614 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2026-02-04 17:13:57.615 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2026-02-04 17:13:57.622 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-04 17:13:57.622 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2026-02-04_17-13-57__6b0f7671-a7e5-4bbd-82a4-8b47d0bc258d__wakuorg_nwaku:latest.log
2026-02-04 17:13:57.622 DEBUG [src.node.waku_node] Starting Node...
2026-02-04 17:13:57.622 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-04 17:13:57.623 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-04 17:13:57.624 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.30.112
2026-02-04 17:13:57.624 DEBUG [src.node.docker_mananger] Generated ports ['29348', '29349', '29350', '29351', '29352']
2026-02-04 17:13:57.624 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-04 17:13:57.624 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-04 17:13:57.624 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-04 17:13:57.624 DEBUG [src.node.waku_node] Using volumes []
2026-02-04 17:13:57.625 DEBUG [src.node.docker_mananger] docker run -i -t -p 29348:29348 -p 29349:29349 -p 29350:29350 -p 29351:29351 -p 29352:29352 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=29350 --rest-port=29348 --tcp-port=29349 --discv5-udp-port=29351 --rest-address=0.0.0.0 --nat=extip:172.18.30.112 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=0950fde1906d64f0a52ba6caf8d2cedda24fcbee46f0638c054833de4f3ecf7c --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=29352 --metrics-logging=true --relay=true --filter=true
2026-02-04 17:13:57.807 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.30.112 waku cafa1f9cb69e03f40a540e23269d7a732b910e4898f16be66d325cbdf48e15db
2026-02-04 17:13:57.838 DEBUG [src.node.docker_mananger] Container started with ID cafa1f9cb69e. Setting up logs at ./log/docker/node1_2026-02-04_17-13-57__6b0f7671-a7e5-4bbd-82a4-8b47d0bc258d__wakuorg_nwaku:latest.log
2026-02-04 17:13:57.838 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 29348
2026-02-04 17:13:57.839 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-04 17:13:57.899 ERROR [src.node.docker_mananger] Max retries reached for container 90590a123a0e. Exiting log stream.
2026-02-04 17:13:58.408 ERROR [src.node.docker_mananger] Max retries reached for container b9fa0198ce85. Exiting log stream.
2026-02-04 17:13:58.840 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:29348/health" -H "Content-Type: application/json" -d 'None'
2026-02-04 17:13:58.843 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_READY","desc":"Relay is not ready, filter will not be able to sort out messages"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"NOT_READY","desc":"No Filter service peer available yet"}]}'
2026-02-04 17:13:58.843 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-04 17:13:58.844 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:29348/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-04 17:13:58.846 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.30.112/tcp/29349/p2p/16Uiu2HAmMzVhb1JbzRfRzi5SmZFzuWtGQhypjYqhAWX7N6u6AhRU","/ip4/172.18.30.112/tcp/29350/ws/p2p/16Uiu2HAmMzVhb1JbzRfRzi5SmZFzuWtGQhypjYqhAWX7N6u6AhRU"],"enrUri":"enr:-L24QF-a1m1LZUHrg9ANCDpq5GOt3BaPHe6V9xQ-J3aF2l9TXJNYXY9gPx1mjKBcQbCRM9JLSeiMXZdHUh17YRsWaZ8CgmlkgnY0gmlwhKwSHnCKbXVsdGlhZGRyc5YACASsEh5wBnKlAAoErBIecAZypt0DgnJzhQACAQAAiXNlY3AyNTZrMaEDirhnX92QlV2UZDuczl4fE4G4GNKOwHHX-L7N_XLuLiODdGNwgnKlg3VkcIJyp4V3YWt1MgU"}'
2026-02-04 17:13:58.846 INFO [src.node.waku_node] REST service is ready !!
2026-02-04 17:13:58.853 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-04 17:13:58.853 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2026-02-04_17-13-57__6b0f7671-a7e5-4bbd-82a4-8b47d0bc258d__wakuorg_nwaku:latest.log
2026-02-04 17:13:58.853 DEBUG [src.node.waku_node] Starting Node...
2026-02-04 17:13:58.853 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-04 17:13:58.855 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-04 17:13:58.855 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.143.220
2026-02-04 17:13:58.855 DEBUG [src.node.docker_mananger] Generated ports ['39718', '39719', '39720', '39721', '39722']
2026-02-04 17:13:58.855 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-04 17:13:58.855 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-04 17:13:58.855 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-04 17:13:58.856 DEBUG [src.node.waku_node] Using volumes []
2026-02-04 17:13:58.856 DEBUG [src.node.docker_mananger] docker run -i -t -p 39718:39718 -p 39719:39719 -p 39720:39720 -p 39721:39721 -p 39722:39722 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=39720 --rest-port=39718 --tcp-port=39719 --discv5-udp-port=39721 --rest-address=0.0.0.0 --nat=extip:172.18.143.220 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=185cf5a25b73db40cedb72a4699bcecb00b9bdc0cc3b7d88866bdfb8aeca9fbe --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=39722 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QF-a1m1LZUHrg9ANCDpq5GOt3BaPHe6V9xQ-J3aF2l9TXJNYXY9gPx1mjKBcQbCRM9JLSeiMXZdHUh17YRsWaZ8CgmlkgnY0gmlwhKwSHnCKbXVsdGlhZGRyc5YACASsEh5wBnKlAAoErBIecAZypt0DgnJzhQACAQAAiXNlY3AyNTZrMaEDirhnX92QlV2UZDuczl4fE4G4GNKOwHHX-L7N_XLuLiODdGNwgnKlg3VkcIJyp4V3YWt1MgU
2026-02-04 17:13:59.045 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.143.220 waku 145a16707ad96fc920a83a9d48b1499be62df738132c29e0327c8b6d36f9b5f0
2026-02-04 17:13:59.074 DEBUG [src.node.docker_mananger] Container started with ID 145a16707ad9. Setting up logs at ./log/docker/node2_2026-02-04_17-13-57__6b0f7671-a7e5-4bbd-82a4-8b47d0bc258d__wakuorg_nwaku:latest.log
2026-02-04 17:13:59.075 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 39718
2026-02-04 17:13:59.075 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-04 17:14:00.076 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:39718/health" -H "Content-Type: application/json" -d 'None'
2026-02-04 17:14:00.088 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_MOUNTED"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"READY"}]}'
2026-02-04 17:14:00.090 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-04 17:14:00.091 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:39718/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-04 17:14:00.095 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.143.220/tcp/39719/p2p/16Uiu2HAkwuWg5jfX5BRBomkfX3pY1o36hnxZ7R3RCnjozvqqA9g3","/ip4/172.18.143.220/tcp/39720/ws/p2p/16Uiu2HAkwuWg5jfX5BRBomkfX3pY1o36hnxZ7R3RCnjozvqqA9g3"],"enrUri":"enr:-L24QBaFO1nmpe24DmmH8e0fzTb_uiMAOALJfldS-qvjy0ujD217FF3iXJRC54Z5OuKNJ7wT6RqyxJT6SfDIwOP_rEUCgmlkgnY0gmlwhKwSj9yKbXVsdGlhZGRyc5YACASsEo_cBpsnAAoErBKP3AabKN0DgnJzhQACAQAAiXNlY3AyNTZrMaECJNkdagsnlYWMKUPxs47-Gxxo9p1ZsmM3JBgFWIYY3iCDdGNwgpsng3VkcIKbKYV3YWt1MgE"}'
2026-02-04 17:14:00.095 INFO [src.node.waku_node] REST service is ready !!
2026-02-04 17:14:00.096 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:39718/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.30.112/tcp/29349/p2p/16Uiu2HAmMzVhb1JbzRfRzi5SmZFzuWtGQhypjYqhAWX7N6u6AhRU"]'
2026-02-04 17:14:00.099 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 17:14:00.100 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:29348/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2026-02-04 17:14:00.102 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 17:14:00.102 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:39718/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2026-02-04 17:14:00.105 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 17:14:00.105 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:29348/relay/v1/auto/messages" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/toychat/2/huilong/proto", "timestamp": '$(date +%s%N)'}'
2026-02-04 17:14:00.110 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 17:14:00.110 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2026-02-04 17:14:00.210 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2026-02-04 17:14:00.211 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:29348/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2026-02-04 17:14:00.213 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1770225240105444198,"ephemeral":false,"proof":""}]'
2026-02-04 17:14:00.215 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2026-02-04 17:14:00.215 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:39718/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2026-02-04 17:14:00.217 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1770225240105444198,"ephemeral":false,"proof":""}]'
2026-02-04 17:14:00.219 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:29348/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2026-02-04 17:14:00.221 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 17:14:00.221 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:39718/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2026-02-04 17:14:00.224 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 17:14:00.224 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:29348/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2026-02-04 17:14:00.230 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 17:14:00.230 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2026-02-04 17:14:00.330 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2026-02-04 17:14:00.331 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:29348/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-04 17:14:00.333 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770225240224589549,"ephemeral":false,"proof":""}]'
2026-02-04 17:14:00.335 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2026-02-04 17:14:00.335 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:39718/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-04 17:14:00.337 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770225240224589549,"ephemeral":false,"proof":""}]'
2026-02-04 17:14:00.340 DEBUG [tests.conftest] Running fixture teardown: test_setup
2026-02-04 17:14:00.341 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2026-02-04 17:14:00.341 DEBUG [src.node.waku_node] Stopping container with id cafa1f9cb69e
2026-02-04 17:14:00.915 DEBUG [src.node.waku_node] Container stopped.
2026-02-04 17:14:00.916 DEBUG [src.node.waku_node] Stopping container with id 145a16707ad9
2026-02-04 17:14:01.446 DEBUG [src.node.waku_node] Container stopped.
2026-02-04 17:14:01.448 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2026-02-04 17:14:01.458 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2026-02-04 17:14:01.463 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
