2026-02-04 12:02:22.302 DEBUG [tests.conftest] Running fixture setup: test_id
2026-02-04 12:02:22.303 DEBUG [tests.conftest] Running test: test_2_nodes_different_cluster_same_shard with id: 2026-02-04_12-02-22__9e5c0fd3-0a8e-4e7a-9839-f709750a613f
2026-02-04 12:02:22.303 DEBUG [src.steps.common] Running fixture setup: common_setup
2026-02-04 12:02:22.303 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2026-02-04 12:02:22.303 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2026-02-04 12:02:22.310 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-04 12:02:22.310 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2026-02-04_12-02-22__9e5c0fd3-0a8e-4e7a-9839-f709750a613f__wakuorg_nwaku:latest.log
2026-02-04 12:02:22.311 DEBUG [src.node.waku_node] Starting Node...
2026-02-04 12:02:22.311 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-04 12:02:22.312 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-04 12:02:22.312 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.146.17
2026-02-04 12:02:22.312 DEBUG [src.node.docker_mananger] Generated ports ['6609', '6610', '6611', '6612', '6613']
2026-02-04 12:02:22.313 DEBUG [src.node.waku_node] Cluster id was resolved to: 2
2026-02-04 12:02:22.313 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-04 12:02:22.313 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-04 12:02:22.313 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-04 12:02:22.313 DEBUG [src.node.waku_node] Using volumes []
2026-02-04 12:02:22.313 DEBUG [src.node.docker_mananger] docker run -i -t -p 6609:6609 -p 6610:6610 -p 6611:6611 -p 6612:6612 -p 6613:6613 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=6611 --rest-port=6609 --tcp-port=6610 --discv5-udp-port=6612 --rest-address=0.0.0.0 --nat=extip:172.18.146.17 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=4ba8fcfbfb8bafecddc9be7edd3aeea9f1b2bbecd5f5efbdff3bc42457b7cdf1 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=6613 --metrics-logging=true --relay=true --filter=true
2026-02-04 12:02:22.498 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.146.17 waku e22f149be73d1d92866cfe518a169ea60399e9915b48e80821129ee00c3b4a17
2026-02-04 12:02:22.530 DEBUG [src.node.docker_mananger] Container started with ID e22f149be73d. Setting up logs at ./log/docker/node1_2026-02-04_12-02-22__9e5c0fd3-0a8e-4e7a-9839-f709750a613f__wakuorg_nwaku:latest.log
2026-02-04 12:02:22.531 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 6609
2026-02-04 12:02:22.531 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-04 12:02:22.579 ERROR [src.node.docker_mananger] Max retries reached for container 1e2ce3d28fc7. Exiting log stream.
2026-02-04 12:02:23.104 ERROR [src.node.docker_mananger] Max retries reached for container 2b522815d5c8. Exiting log stream.
2026-02-04 12:02:23.532 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6609/health" -H "Content-Type: application/json" -d 'None'
2026-02-04 12:02:23.535 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_READY","desc":"Relay is not ready, filter will not be able to sort out messages"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"NOT_READY","desc":"No Filter service peer available yet"}]}'
2026-02-04 12:02:23.536 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-04 12:02:23.536 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6609/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-04 12:02:23.538 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.146.17/tcp/6610/p2p/16Uiu2HAm3uEiiUVFHxt659m3AwqA3Nr8pPKcpoGKAaarKv2V8sUp","/ip4/172.18.146.17/tcp/6611/ws/p2p/16Uiu2HAm3uEiiUVFHxt659m3AwqA3Nr8pPKcpoGKAaarKv2V8sUp"],"enrUri":"enr:-L24QOzli3W9Db0sEHc9qX-_nUQenKzVa9wKfxD6nSd8ilKMWCzNW2t-onHWXlK8U3fUis8_qzK9uIuw6uyG_w0SO2oCgmlkgnY0gmlwhKwSkhGKbXVsdGlhZGRyc5YACASsEpIRBhnSAAoErBKSEQYZ090DgnJzhQACAQAAiXNlY3AyNTZrMaECfe0yUFCT2djkAEog9svSh_EhluZvQUK66uJ-G5dsEQ2DdGNwghnSg3VkcIIZ1IV3YWt1MgU"}'
2026-02-04 12:02:23.538 INFO [src.node.waku_node] REST service is ready !!
2026-02-04 12:02:23.545 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-04 12:02:23.545 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2026-02-04_12-02-22__9e5c0fd3-0a8e-4e7a-9839-f709750a613f__wakuorg_nwaku:latest.log
2026-02-04 12:02:23.545 DEBUG [src.node.waku_node] Starting Node...
2026-02-04 12:02:23.545 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-04 12:02:23.546 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-04 12:02:23.547 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.95.54
2026-02-04 12:02:23.547 DEBUG [src.node.docker_mananger] Generated ports ['56484', '56485', '56486', '56487', '56488']
2026-02-04 12:02:23.547 DEBUG [src.node.waku_node] Cluster id was resolved to: 4
2026-02-04 12:02:23.547 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-04 12:02:23.547 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-04 12:02:23.547 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-04 12:02:23.547 DEBUG [src.node.waku_node] Using volumes []
2026-02-04 12:02:23.548 DEBUG [src.node.docker_mananger] docker run -i -t -p 56484:56484 -p 56485:56485 -p 56486:56486 -p 56487:56487 -p 56488:56488 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=56486 --rest-port=56484 --tcp-port=56485 --discv5-udp-port=56487 --rest-address=0.0.0.0 --nat=extip:172.18.95.54 --peer-exchange=true --discv5-discovery=true --cluster-id=4 --nodekey=3f5eaca99f5ee075f4eefcd18e02d406c63d5c6f0bf72af8cf3cfcba6d6aecef --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=56488 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QOzli3W9Db0sEHc9qX-_nUQenKzVa9wKfxD6nSd8ilKMWCzNW2t-onHWXlK8U3fUis8_qzK9uIuw6uyG_w0SO2oCgmlkgnY0gmlwhKwSkhGKbXVsdGlhZGRyc5YACASsEpIRBhnSAAoErBKSEQYZ090DgnJzhQACAQAAiXNlY3AyNTZrMaECfe0yUFCT2djkAEog9svSh_EhluZvQUK66uJ-G5dsEQ2DdGNwghnSg3VkcIIZ1IV3YWt1MgU
2026-02-04 12:02:23.740 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.95.54 waku de3d27b2329190e1e6a5eaf5814bfbaa1e0f390df1bbcf7c4e5c19f28e03561e
2026-02-04 12:02:23.774 DEBUG [src.node.docker_mananger] Container started with ID de3d27b23291. Setting up logs at ./log/docker/node2_2026-02-04_12-02-22__9e5c0fd3-0a8e-4e7a-9839-f709750a613f__wakuorg_nwaku:latest.log
2026-02-04 12:02:23.775 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 56484
2026-02-04 12:02:23.775 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-04 12:02:24.775 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:56484/health" -H "Content-Type: application/json" -d 'None'
2026-02-04 12:02:24.788 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_MOUNTED"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"READY"}]}'
2026-02-04 12:02:24.790 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-04 12:02:24.790 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:56484/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-04 12:02:24.796 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.95.54/tcp/56485/p2p/16Uiu2HAm3xnYeVQbJd2X6XEdVkdz7SJD9ECy54YiaR7CxKKXavix","/ip4/172.18.95.54/tcp/56486/ws/p2p/16Uiu2HAm3xnYeVQbJd2X6XEdVkdz7SJD9ECy54YiaR7CxKKXavix"],"enrUri":"enr:-L24QMtPXZh40mvLSw1AUm_xOKYoCM6kAor3ovz-yvT6rlh3S1dmjTkRjJ_taDlCyEjMhSuhFXLrhmv3BZjvm-Aa6UgCgmlkgnY0gmlwhKwSXzaKbXVsdGlhZGRyc5YACASsEl82BtylAAoErBJfNgbcpt0DgnJzhQAEAQAAiXNlY3AyNTZrMaECftXs2WsXIkMYUKz9Dx-LFJTs_oZRi41goKvk-CVgXz2DdGNwgtylg3VkcILcp4V3YWt1MgE"}'
2026-02-04 12:02:24.797 INFO [src.node.waku_node] REST service is ready !!
2026-02-04 12:02:24.797 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:56484/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.146.17/tcp/6610/p2p/16Uiu2HAm3uEiiUVFHxt659m3AwqA3Nr8pPKcpoGKAaarKv2V8sUp"]'
2026-02-04 12:02:24.821 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 12:02:24.824 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:6609/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2026-02-04 12:02:24.830 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 12:02:24.831 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:56484/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/4/0"]'
2026-02-04 12:02:24.835 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 12:02:24.836 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:6609/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2026-02-04 12:02:24.841 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-04 12:02:24.842 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2026-02-04 12:02:24.942 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2026-02-04 12:02:24.942 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:6609/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-04 12:02:24.944 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770206544836132303,"ephemeral":false,"proof":""}]'
2026-02-04 12:02:24.946 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2026-02-04 12:02:24.946 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:56484/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-04 12:02:24.949 ERROR [src.node.api_clients.base_client] HTTP error occurred: 404 Client Error: Not Found for url: http://127.0.0.1:56484/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0. Response content: b''
2026-02-04 12:02:24.951 DEBUG [tests.conftest] Running fixture teardown: test_setup
2026-02-04 12:02:24.952 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2026-02-04 12:02:24.952 DEBUG [src.node.waku_node] Stopping container with id e22f149be73d
2026-02-04 12:02:25.499 DEBUG [src.node.waku_node] Container stopped.
2026-02-04 12:02:25.499 DEBUG [src.node.waku_node] Stopping container with id de3d27b23291
2026-02-04 12:02:26.058 DEBUG [src.node.waku_node] Container stopped.
2026-02-04 12:02:26.059 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2026-02-04 12:02:26.068 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2026-02-04 12:02:26.075 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
