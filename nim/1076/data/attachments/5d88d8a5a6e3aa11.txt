2026-02-11 04:45:06.266 DEBUG [tests.conftest] Running fixture setup: test_id
2026-02-11 04:45:06.266 DEBUG [tests.conftest] Running test: test_lightpush_node_with_relay_works_correctly with id: 2026-02-11_04-45-06__4e656781-7153-4a5e-ad62-f78875e6e028
2026-02-11 04:45:06.267 DEBUG [src.steps.common] Running fixture setup: common_setup
2026-02-11 04:45:06.267 DEBUG [src.steps.light_push] Running fixture setup: light_push_setup
2026-02-11 04:45:06.274 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-11 04:45:06.274 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/receiving_node1_2026-02-11_04-45-06__4e656781-7153-4a5e-ad62-f78875e6e028__wakuorg_nwaku:latest.log
2026-02-11 04:45:06.274 DEBUG [src.node.waku_node] Starting Node...
2026-02-11 04:45:06.274 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-11 04:45:06.275 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-11 04:45:06.276 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.26.204
2026-02-11 04:45:06.276 DEBUG [src.node.docker_mananger] Generated ports ['58402', '58403', '58404', '58405', '58406']
2026-02-11 04:45:06.276 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-11 04:45:06.276 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-11 04:45:06.276 DEBUG [src.node.waku_node] Using volumes []
2026-02-11 04:45:06.276 DEBUG [src.node.docker_mananger] docker run -i -t -p 58402:58402 -p 58403:58403 -p 58404:58404 -p 58405:58405 -p 58406:58406 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=58404 --rest-port=58402 --tcp-port=58403 --discv5-udp-port=58405 --rest-address=0.0.0.0 --nat=extip:172.18.26.204 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=acddd471faf6d8abaadce71aa2ba3f038fe5c31054fadfbabb6beadadc5cdedb --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=58406 --metrics-logging=true --lightpush=true --relay=true --filter=true
2026-02-11 04:45:06.461 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.26.204 waku 2b276ab85f5a478eedc291e7377cc3a650a85a7b5b47c02cbbfeb9a0b2367f48
2026-02-11 04:45:06.491 DEBUG [src.node.docker_mananger] Container started with ID 2b276ab85f5a. Setting up logs at ./log/docker/receiving_node1_2026-02-11_04-45-06__4e656781-7153-4a5e-ad62-f78875e6e028__wakuorg_nwaku:latest.log
2026-02-11 04:45:06.493 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 58402
2026-02-11 04:45:06.493 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-11 04:45:06.546 ERROR [src.node.docker_mananger] Max retries reached for container 16182deb5c94. Exiting log stream.
2026-02-11 04:45:07.050 ERROR [src.node.docker_mananger] Max retries reached for container a437eeaed0a2. Exiting log stream.
2026-02-11 04:45:07.493 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58402/health" -H "Content-Type: application/json" -d 'None'
2026-02-11 04:45:07.496 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_READY","desc":"Node has no relay peers to fullfill push requests"},{"Legacy Lightpush":"NOT_READY","desc":"Node has no relay peers to fullfill push requests"},{"Filter":"NOT_READY","desc":"Relay is not ready, filter will not be able to sort out messages"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"NOT_READY","desc":"No Filter service peer available yet"}]}'
2026-02-11 04:45:07.496 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-11 04:45:07.496 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58402/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-11 04:45:07.498 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.26.204/tcp/58403/p2p/16Uiu2HAmEeewA5dTVsMfx581wturMtjp7QFdiWw9iMQbgBjaRgjJ","/ip4/172.18.26.204/tcp/58404/ws/p2p/16Uiu2HAmEeewA5dTVsMfx581wturMtjp7QFdiWw9iMQbgBjaRgjJ"],"enrUri":"enr:-L24QEaGFW3Gln1MVMg1wrI6juQee-oMYUpJsbxnAi-sEjGDWXdroKRzAfqq_GfM-kp3sLdYaE5Zt_SWTNQXuHLwAjACgmlkgnY0gmlwhKwSGsyKbXVsdGlhZGRyc5YACASsEhrMBuQjAAoErBIazAbkJN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDHaFrhqod1O164zJcQJHz_ugvp8wdQJy2x6nC8O3coSGDdGNwguQjg3VkcILkJYV3YWt1Mg0"}'
2026-02-11 04:45:07.499 INFO [src.node.waku_node] REST service is ready !!
2026-02-11 04:45:07.505 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-11 04:45:07.505 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/lightpush_node1_2026-02-11_04-45-06__4e656781-7153-4a5e-ad62-f78875e6e028__wakuorg_nwaku:latest.log
2026-02-11 04:45:07.505 DEBUG [src.node.waku_node] Starting Node...
2026-02-11 04:45:07.505 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-11 04:45:07.507 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-11 04:45:07.507 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.104.93
2026-02-11 04:45:07.507 DEBUG [src.node.docker_mananger] Generated ports ['54466', '54467', '54468', '54469', '54470']
2026-02-11 04:45:07.507 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-11 04:45:07.507 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-11 04:45:07.507 DEBUG [src.node.waku_node] Using volumes []
2026-02-11 04:45:07.507 DEBUG [src.node.docker_mananger] docker run -i -t -p 54466:54466 -p 54467:54467 -p 54468:54468 -p 54469:54469 -p 54470:54470 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=54468 --rest-port=54466 --tcp-port=54467 --discv5-udp-port=54469 --rest-address=0.0.0.0 --nat=extip:172.18.104.93 --peer-exchange=true --discv5-discovery=true --cluster-id=3 --nodekey=c86c36da38a1dc8bcb80bc34795437daac5fc0e32effde3b8ae40a23eb92cc9b --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=54470 --metrics-logging=true --discv5-bootstrap-node=enr:-L24QEaGFW3Gln1MVMg1wrI6juQee-oMYUpJsbxnAi-sEjGDWXdroKRzAfqq_GfM-kp3sLdYaE5Zt_SWTNQXuHLwAjACgmlkgnY0gmlwhKwSGsyKbXVsdGlhZGRyc5YACASsEhrMBuQjAAoErBIazAbkJN0DgnJzhQADAQAAiXNlY3AyNTZrMaEDHaFrhqod1O164zJcQJHz_ugvp8wdQJy2x6nC8O3coSGDdGNwguQjg3VkcILkJYV3YWt1Mg0 --lightpushnode=/ip4/172.18.26.204/tcp/58403/p2p/16Uiu2HAmEeewA5dTVsMfx581wturMtjp7QFdiWw9iMQbgBjaRgjJ --lightpush=true --relay=true --filter=true
2026-02-11 04:45:07.684 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.104.93 waku 33a3e3b2d81923c3ca446f985d1d3bf4383216cef5344d760a3273d6290ff77a
2026-02-11 04:45:07.718 DEBUG [src.node.docker_mananger] Container started with ID 33a3e3b2d819. Setting up logs at ./log/docker/lightpush_node1_2026-02-11_04-45-06__4e656781-7153-4a5e-ad62-f78875e6e028__wakuorg_nwaku:latest.log
2026-02-11 04:45:07.719 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 54466
2026-02-11 04:45:07.719 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-11 04:45:08.719 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:54466/health" -H "Content-Type: application/json" -d 'None'
2026-02-11 04:45:08.724 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_READY","desc":"Node has no relay peers to fullfill push requests"},{"Legacy Lightpush":"NOT_READY","desc":"Node has no relay peers to fullfill push requests"},{"Filter":"NOT_READY","desc":"Relay is not ready, filter will not be able to sort out messages"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"READY"},{"Legacy Lightpush Client":"READY"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"READY"}]}'
2026-02-11 04:45:08.724 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-11 04:45:08.724 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:54466/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-11 04:45:08.726 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.104.93/tcp/54467/p2p/16Uiu2HAm5uqyPK2KdNsa6mxd9rJjyPmCxrHuRi75dNqHRk6zfcxA","/ip4/172.18.104.93/tcp/54468/ws/p2p/16Uiu2HAm5uqyPK2KdNsa6mxd9rJjyPmCxrHuRi75dNqHRk6zfcxA"],"enrUri":"enr:-L24QKpUE0uRq7L7khsMWB--2lC4zMRDuEkrApDtp6ALRaJ-OSr9yAe6pMJV-udPWeXe5dRn5vk2DnfZ1s4yTWlhUIMCgmlkgnY0gmlwhKwSaF2KbXVsdGlhZGRyc5YACASsEmhdBtTDAAoErBJoXQbUxN0DgnJzhQADAQAAiXNlY3AyNTZrMaECm8xuVfVRCwb9iU-Wwyb-kFTGT0bIQ_rMNj7l78RPO8uDdGNwgtTDg3VkcILUxYV3YWt1Mg0"}'
2026-02-11 04:45:08.727 INFO [src.node.waku_node] REST service is ready !!
2026-02-11 04:45:08.727 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:54466/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.26.204/tcp/58403/p2p/16Uiu2HAmEeewA5dTVsMfx581wturMtjp7QFdiWw9iMQbgBjaRgjJ"]'
2026-02-11 04:45:08.765 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-11 04:45:08.766 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58402/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2026-02-11 04:45:08.780 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-11 04:45:08.780 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:54466/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/3/0"]'
2026-02-11 04:45:08.784 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-11 04:45:08.784 DEBUG [src.libs.common] Sleeping for 0.5 seconds
2026-02-11 04:45:09.284 DEBUG [src.steps.light_push] Lightpushing message
2026-02-11 04:45:09.285 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:54466/lightpush/v1/message" -H "Content-Type: application/json" -d '{"pubsubTopic": "/waku/2/rs/3/0", "message": {"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": 1770785109284836560}}'
2026-02-11 04:45:09.296 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-11 04:45:09.296 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2026-02-11 04:45:09.396 DEBUG [src.steps.light_push] Checking that peer NODE_1:wakuorg/nwaku:latest can find the lightpushed message
2026-02-11 04:45:09.396 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-11 04:45:09.399 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770785109284836560,"ephemeral":false,"proof":""}]'
2026-02-11 04:45:09.400 DEBUG [src.steps.light_push] Checking that peer NODE_2:wakuorg/nwaku:latest can find the lightpushed message
2026-02-11 04:45:09.401 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:54466/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-11 04:45:09.403 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770785109284836560,"ephemeral":false,"proof":""}]'
2026-02-11 04:45:09.404 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:54466/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2026-02-11 04:45:09.409 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-11 04:45:09.410 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:58402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d '{"payload": "TGlnaHQgcHVzaCB3b3JrcyEh", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2026-02-11 04:45:09.414 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-11 04:45:09.415 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2026-02-11 04:45:09.515 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:58402/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-11 04:45:09.517 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770785109404773344,"ephemeral":false,"proof":""},{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770785109410160049,"ephemeral":false,"proof":""}]'
2026-02-11 04:45:09.518 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:54466/relay/v1/messages/%2Fwaku%2F2%2Frs%2F3%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-11 04:45:09.520 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770785109404773344,"ephemeral":false,"proof":""},{"payload":"TGlnaHQgcHVzaCB3b3JrcyEh","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770785109410160049,"ephemeral":false,"proof":""}]'
2026-02-11 04:45:09.521 DEBUG [tests.conftest] Running fixture teardown: test_setup
2026-02-11 04:45:09.522 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2026-02-11 04:45:09.522 DEBUG [src.node.waku_node] Stopping container with id 2b276ab85f5a
2026-02-11 04:45:10.083 DEBUG [src.node.waku_node] Container stopped.
2026-02-11 04:45:10.083 DEBUG [src.node.waku_node] Stopping container with id 33a3e3b2d819
2026-02-11 04:45:10.592 DEBUG [src.node.waku_node] Container stopped.
2026-02-11 04:45:10.593 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2026-02-11 04:45:10.600 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2026-02-11 04:45:10.606 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
