2026-02-03 04:36:39.718 DEBUG [tests.conftest] Running fixture setup: test_id
2026-02-03 04:36:39.718 DEBUG [tests.conftest] Running test: test_node_uses_both_auto_and_regular_apis with id: 2026-02-03_04-36-39__36d389dc-800c-42c3-af1f-37be1613df30
2026-02-03 04:36:39.719 DEBUG [src.steps.common] Running fixture setup: common_setup
2026-02-03 04:36:39.719 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2026-02-03 04:36:39.719 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2026-02-03 04:36:39.726 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-03 04:36:39.726 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2026-02-03_04-36-39__36d389dc-800c-42c3-af1f-37be1613df30__wakuorg_nwaku:latest.log
2026-02-03 04:36:39.726 DEBUG [src.node.waku_node] Starting Node...
2026-02-03 04:36:39.727 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-03 04:36:39.728 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-03 04:36:39.728 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.71.62
2026-02-03 04:36:39.728 DEBUG [src.node.docker_mananger] Generated ports ['55365', '55366', '55367', '55368', '55369']
2026-02-03 04:36:39.728 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-03 04:36:39.728 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-03 04:36:39.729 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-03 04:36:39.729 DEBUG [src.node.waku_node] Using volumes []
2026-02-03 04:36:39.729 DEBUG [src.node.docker_mananger] docker run -i -t -p 55365:55365 -p 55366:55366 -p 55367:55367 -p 55368:55368 -p 55369:55369 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=55367 --rest-port=55365 --tcp-port=55366 --discv5-udp-port=55368 --rest-address=0.0.0.0 --nat=extip:172.18.71.62 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=bd4cdac0cf3e8504f3baa1a9adaaee0a6ab2337f85cbf6aae0ba6c50c696e2aa --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=55369 --metrics-logging=true --relay=true --filter=true
2026-02-03 04:36:39.910 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.71.62 waku 01f361b05359b9f870823f6fbc3061ccd1fbe23c3cb54ab64ba6fba6fcae8efc
2026-02-03 04:36:39.945 DEBUG [src.node.docker_mananger] Container started with ID 01f361b05359. Setting up logs at ./log/docker/node1_2026-02-03_04-36-39__36d389dc-800c-42c3-af1f-37be1613df30__wakuorg_nwaku:latest.log
2026-02-03 04:36:39.946 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 55365
2026-02-03 04:36:39.946 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-03 04:36:39.970 ERROR [src.node.docker_mananger] Max retries reached for container ea87acbb50e1. Exiting log stream.
2026-02-03 04:36:40.526 ERROR [src.node.docker_mananger] Max retries reached for container 6dd016f3bc2e. Exiting log stream.
2026-02-03 04:36:40.948 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:55365/health" -H "Content-Type: application/json" -d 'None'
2026-02-03 04:36:40.951 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_READY","desc":"Relay is not ready, filter will not be able to sort out messages"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"NOT_READY","desc":"No Filter service peer available yet"}]}'
2026-02-03 04:36:40.951 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-03 04:36:40.951 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:55365/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-03 04:36:40.953 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.71.62/tcp/55366/p2p/16Uiu2HAm6ZdFqo7D7eUWfxLeKTKjbW7tE1XCb8LNXCtBxzze3dvb","/ip4/172.18.71.62/tcp/55367/ws/p2p/16Uiu2HAm6ZdFqo7D7eUWfxLeKTKjbW7tE1XCb8LNXCtBxzze3dvb"],"enrUri":"enr:-L24QL12ou9wp2z1bx8qORbKJUR75u3JC5D2MCbzYO6FOHzZTJuuJEqaSv3kmqOPIWwjByuDasX7WvZlz9jvvBGiZ6gCgmlkgnY0gmlwhKwSRz6KbXVsdGlhZGRyc5YACASsEkc-BthGAAoErBJHPgbYR90DgnJzhQACAQAAiXNlY3AyNTZrMaECpXofmETJJXEceUIBYCOKHBeh8H9Tlyd2V2npHsfvNzSDdGNwgthGg3VkcILYSIV3YWt1MgU"}'
2026-02-03 04:36:40.953 INFO [src.node.waku_node] REST service is ready !!
2026-02-03 04:36:40.960 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-03 04:36:40.960 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2026-02-03_04-36-39__36d389dc-800c-42c3-af1f-37be1613df30__wakuorg_nwaku:latest.log
2026-02-03 04:36:40.960 DEBUG [src.node.waku_node] Starting Node...
2026-02-03 04:36:40.960 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-03 04:36:40.961 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-03 04:36:40.962 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.216.117
2026-02-03 04:36:40.962 DEBUG [src.node.docker_mananger] Generated ports ['21874', '21875', '21876', '21877', '21878']
2026-02-03 04:36:40.962 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-03 04:36:40.962 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-03 04:36:40.962 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-03 04:36:40.962 DEBUG [src.node.waku_node] Using volumes []
2026-02-03 04:36:40.962 DEBUG [src.node.docker_mananger] docker run -i -t -p 21874:21874 -p 21875:21875 -p 21876:21876 -p 21877:21877 -p 21878:21878 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=21876 --rest-port=21874 --tcp-port=21875 --discv5-udp-port=21877 --rest-address=0.0.0.0 --nat=extip:172.18.216.117 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=88fe96dc0fe2c06dcf1d7d7f35efaebe6e0d3f6699ee657c892bdd3880a2cc09 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=21878 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QL12ou9wp2z1bx8qORbKJUR75u3JC5D2MCbzYO6FOHzZTJuuJEqaSv3kmqOPIWwjByuDasX7WvZlz9jvvBGiZ6gCgmlkgnY0gmlwhKwSRz6KbXVsdGlhZGRyc5YACASsEkc-BthGAAoErBJHPgbYR90DgnJzhQACAQAAiXNlY3AyNTZrMaECpXofmETJJXEceUIBYCOKHBeh8H9Tlyd2V2npHsfvNzSDdGNwgthGg3VkcILYSIV3YWt1MgU
2026-02-03 04:36:41.150 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.216.117 waku b24c2bb05452e9841dbee2bb2faa0a6803512b9b027593272d43ed346bf349be
2026-02-03 04:36:41.179 DEBUG [src.node.docker_mananger] Container started with ID b24c2bb05452. Setting up logs at ./log/docker/node2_2026-02-03_04-36-39__36d389dc-800c-42c3-af1f-37be1613df30__wakuorg_nwaku:latest.log
2026-02-03 04:36:41.180 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 21874
2026-02-03 04:36:41.180 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-03 04:36:42.180 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:21874/health" -H "Content-Type: application/json" -d 'None'
2026-02-03 04:36:42.195 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_MOUNTED"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"READY"}]}'
2026-02-03 04:36:42.196 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-03 04:36:42.196 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:21874/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-03 04:36:42.203 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.216.117/tcp/21875/p2p/16Uiu2HAm65xFR7SmFfwaTb4z1416CNYJhftCmH39FyfxtUjn1THP","/ip4/172.18.216.117/tcp/21876/ws/p2p/16Uiu2HAm65xFR7SmFfwaTb4z1416CNYJhftCmH39FyfxtUjn1THP"],"enrUri":"enr:-L24QNFx3qtpjKkugidIzyqmhs1cBN_X3pEj2ERy7i2XTnGbFZVqaN9tlzcJMJUxBqnjr6w9MVM6f62wEyKwzjlvwYQCgmlkgnY0gmlwhKwS2HWKbXVsdGlhZGRyc5YACASsEth1BlVzAAoErBLYdQZVdN0DgnJzhQACAQAAiXNlY3AyNTZrMaECnmNV-UYugFhaQccN7kUnQm9GvlIv4ZKu5B2XvbT4FK6DdGNwglVzg3VkcIJVdYV3YWt1MgE"}'
2026-02-03 04:36:42.203 INFO [src.node.waku_node] REST service is ready !!
2026-02-03 04:36:42.203 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:21874/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.71.62/tcp/55366/p2p/16Uiu2HAm6ZdFqo7D7eUWfxLeKTKjbW7tE1XCb8LNXCtBxzze3dvb"]'
2026-02-03 04:36:42.206 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-03 04:36:42.206 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:55365/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2026-02-03 04:36:42.208 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-03 04:36:42.209 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:21874/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2026-02-03 04:36:42.211 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-03 04:36:42.211 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:55365/relay/v1/auto/messages" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/toychat/2/huilong/proto", "timestamp": '$(date +%s%N)'}'
2026-02-03 04:36:42.216 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-03 04:36:42.216 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2026-02-03 04:36:42.316 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2026-02-03 04:36:42.317 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:55365/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2026-02-03 04:36:42.319 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1770093402211625684,"ephemeral":false,"proof":""}]'
2026-02-03 04:36:42.321 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2026-02-03 04:36:42.321 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:21874/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2026-02-03 04:36:42.324 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1770093402211625684,"ephemeral":false,"proof":""}]'
2026-02-03 04:36:42.325 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:55365/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2026-02-03 04:36:42.327 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-03 04:36:42.328 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:21874/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2026-02-03 04:36:42.330 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-03 04:36:42.331 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:55365/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2026-02-03 04:36:42.335 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-03 04:36:42.335 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2026-02-03 04:36:42.436 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2026-02-03 04:36:42.437 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:55365/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-03 04:36:42.439 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770093402331063785,"ephemeral":false,"proof":""}]'
2026-02-03 04:36:42.440 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2026-02-03 04:36:42.441 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:21874/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-03 04:36:42.443 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770093402331063785,"ephemeral":false,"proof":""}]'
2026-02-03 04:36:42.445 DEBUG [tests.conftest] Running fixture teardown: test_setup
2026-02-03 04:36:42.446 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2026-02-03 04:36:42.447 DEBUG [src.node.waku_node] Stopping container with id 01f361b05359
2026-02-03 04:36:42.958 DEBUG [src.node.waku_node] Container stopped.
2026-02-03 04:36:42.958 DEBUG [src.node.waku_node] Stopping container with id b24c2bb05452
2026-02-03 04:36:43.493 DEBUG [src.node.waku_node] Container stopped.
2026-02-03 04:36:43.495 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2026-02-03 04:36:43.500 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2026-02-03 04:36:43.504 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
