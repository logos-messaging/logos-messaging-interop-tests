2026-02-10 04:47:51.978 DEBUG [tests.conftest] Running fixture setup: test_id
2026-02-10 04:47:51.978 DEBUG [tests.conftest] Running test: test_node_uses_both_auto_and_regular_apis with id: 2026-02-10_04-47-51__83b38160-5d1b-40a7-9349-20fd26cdb75b
2026-02-10 04:47:51.979 DEBUG [src.steps.common] Running fixture setup: common_setup
2026-02-10 04:47:51.979 DEBUG [src.steps.relay] Running fixture setup: relay_setup
2026-02-10 04:47:51.979 DEBUG [src.steps.sharding] Running fixture setup: sharding_setup
2026-02-10 04:47:51.985 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-10 04:47:51.986 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node1_2026-02-10_04-47-51__83b38160-5d1b-40a7-9349-20fd26cdb75b__wakuorg_nwaku:latest.log
2026-02-10 04:47:51.986 DEBUG [src.node.waku_node] Starting Node...
2026-02-10 04:47:51.986 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-10 04:47:51.987 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-10 04:47:51.987 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.244.202
2026-02-10 04:47:51.987 DEBUG [src.node.docker_mananger] Generated ports ['50805', '50806', '50807', '50808', '50809']
2026-02-10 04:47:51.987 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-10 04:47:51.988 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-10 04:47:51.988 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-10 04:47:51.988 DEBUG [src.node.waku_node] Using volumes []
2026-02-10 04:47:51.988 DEBUG [src.node.docker_mananger] docker run -i -t -p 50805:50805 -p 50806:50806 -p 50807:50807 -p 50808:50808 -p 50809:50809 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=50807 --rest-port=50805 --tcp-port=50806 --discv5-udp-port=50808 --rest-address=0.0.0.0 --nat=extip:172.18.244.202 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=6abcc0acdedb2fbab2bba532cfbfa0056a3c176b6ea4bac91f3cf878dd2bbcdd --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=50809 --metrics-logging=true --relay=true --filter=true
2026-02-10 04:47:52.152 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.244.202 waku dc1168c18386bacdb8cfa6e7fec0ab8fe4c8e58a5fd9ed6b3f9652fa17aeb6fe
2026-02-10 04:47:52.180 DEBUG [src.node.docker_mananger] Container started with ID dc1168c18386. Setting up logs at ./log/docker/node1_2026-02-10_04-47-51__83b38160-5d1b-40a7-9349-20fd26cdb75b__wakuorg_nwaku:latest.log
2026-02-10 04:47:52.181 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 50805
2026-02-10 04:47:52.181 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-10 04:47:52.291 ERROR [src.node.docker_mananger] Max retries reached for container 83a7182fe0bf. Exiting log stream.
2026-02-10 04:47:52.775 ERROR [src.node.docker_mananger] Max retries reached for container 8fe688dccae1. Exiting log stream.
2026-02-10 04:47:53.181 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:50805/health" -H "Content-Type: application/json" -d 'None'
2026-02-10 04:47:53.184 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_READY","desc":"Relay is not ready, filter will not be able to sort out messages"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"NOT_READY","desc":"No Filter service peer available yet"}]}'
2026-02-10 04:47:53.184 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-10 04:47:53.185 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:50805/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-10 04:47:53.187 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.244.202/tcp/50806/p2p/16Uiu2HAmGRenh2vB2tFPN7Fh7qA92BNDAF3MYXFCf4EssMVruDtX","/ip4/172.18.244.202/tcp/50807/ws/p2p/16Uiu2HAmGRenh2vB2tFPN7Fh7qA92BNDAF3MYXFCf4EssMVruDtX"],"enrUri":"enr:-L24QMI2GYtlooV1NCmbTxjZ-qhQ93FXWeKvWDTbhKIG-u7oLX-BLlyFX8pIb0oTz7quw-df9ZOXCz9Ic0MOAXU2qKgCgmlkgnY0gmlwhKwS9MqKbXVsdGlhZGRyc5YACASsEvTKBsZ2AAoErBL0ygbGd90DgnJzhQACAQAAiXNlY3AyNTZrMaEDOAQUDAKHpuJIiElJggoGEIrj7cwzl-b8fOo3ONZAsQyDdGNwgsZ2g3VkcILGeIV3YWt1MgU"}'
2026-02-10 04:47:53.187 INFO [src.node.waku_node] REST service is ready !!
2026-02-10 04:47:53.193 DEBUG [src.node.docker_mananger] Docker client initialized with image wakuorg/nwaku:latest
2026-02-10 04:47:53.194 DEBUG [src.node.waku_node] WakuNode instance initialized with log path ./log/docker/node2_2026-02-10_04-47-51__83b38160-5d1b-40a7-9349-20fd26cdb75b__wakuorg_nwaku:latest.log
2026-02-10 04:47:53.194 DEBUG [src.node.waku_node] Starting Node...
2026-02-10 04:47:53.194 DEBUG [src.node.docker_mananger] Attempting to create or retrieve network waku
2026-02-10 04:47:53.195 DEBUG [src.node.docker_mananger] Network waku already exists
2026-02-10 04:47:53.195 DEBUG [src.node.docker_mananger] Generated random external IP 172.18.196.73
2026-02-10 04:47:53.195 DEBUG [src.node.docker_mananger] Generated ports ['41440', '41441', '41442', '41443', '41444']
2026-02-10 04:47:53.196 DEBUG [src.node.waku_node] Removing pubsub-topic from nwaku args
2026-02-10 04:47:53.196 DEBUG [src.node.waku_node] RLN credentials were not set
2026-02-10 04:47:53.196 INFO [src.node.waku_node] RLN credentials not set or credential store not available, starting without RLN
2026-02-10 04:47:53.196 DEBUG [src.node.waku_node] Using volumes []
2026-02-10 04:47:53.196 DEBUG [src.node.docker_mananger] docker run -i -t -p 41440:41440 -p 41441:41441 -p 41442:41442 -p 41443:41443 -p 41444:41444 wakuorg/nwaku:latest --listen-address=0.0.0.0 --rest=true --rest-admin=true --websocket-support=true --log-level=TRACE --rest-relay-cache-capacity=100 --websocket-port=41442 --rest-port=41440 --tcp-port=41441 --discv5-udp-port=41443 --rest-address=0.0.0.0 --nat=extip:172.18.196.73 --peer-exchange=true --discv5-discovery=true --cluster-id=2 --nodekey=53e5fdc60a3bea21acba9ce16da6cb0f6e88abc7cf6c39bef8e1accaf7dee180 --shard=0 --metrics-server=true --metrics-server-address=0.0.0.0 --metrics-server-port=41444 --metrics-logging=true --relay=true --discv5-bootstrap-node=enr:-L24QMI2GYtlooV1NCmbTxjZ-qhQ93FXWeKvWDTbhKIG-u7oLX-BLlyFX8pIb0oTz7quw-df9ZOXCz9Ic0MOAXU2qKgCgmlkgnY0gmlwhKwS9MqKbXVsdGlhZGRyc5YACASsEvTKBsZ2AAoErBL0ygbGd90DgnJzhQACAQAAiXNlY3AyNTZrMaEDOAQUDAKHpuJIiElJggoGEIrj7cwzl-b8fOo3ONZAsQyDdGNwgsZ2g3VkcILGeIV3YWt1MgU
2026-02-10 04:47:53.352 DEBUG [src.node.docker_mananger] docker network connect --ip 172.18.196.73 waku 3d488035f225b7bfc27427c965cfc950f6ceb9802e6c877fe7dbc19ce33c3285
2026-02-10 04:47:53.377 DEBUG [src.node.docker_mananger] Container started with ID 3d488035f225. Setting up logs at ./log/docker/node2_2026-02-10_04-47-51__83b38160-5d1b-40a7-9349-20fd26cdb75b__wakuorg_nwaku:latest.log
2026-02-10 04:47:53.377 DEBUG [src.node.waku_node] Started container from image wakuorg/nwaku:latest. REST: 41440
2026-02-10 04:47:53.378 DEBUG [src.libs.common] Sleeping for 1 seconds
2026-02-10 04:47:54.380 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:41440/health" -H "Content-Type: application/json" -d 'None'
2026-02-10 04:47:54.390 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"nodeHealth":"READY","protocolsHealth":[{"Relay":"NOT_READY","desc":"No connected peers"},{"Rln Relay":"NOT_MOUNTED"},{"Lightpush":"NOT_MOUNTED"},{"Legacy Lightpush":"NOT_MOUNTED"},{"Filter":"NOT_MOUNTED"},{"Store":"NOT_MOUNTED"},{"Legacy Store":"NOT_MOUNTED"},{"Peer Exchange":"READY"},{"Rendezvous":"NOT_READY","desc":"No Rendezvous peers are available yet"},{"Mix":"NOT_MOUNTED"},{"Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Legacy Lightpush Client":"NOT_READY","desc":"No Lightpush service peer available yet"},{"Store Client":"NOT_READY","desc":"No Store service peer available yet, neither Store service set up for the node"},{"Legacy Store Client":"NOT_READY","desc":"No Legacy Store service peers are available yet, neither Store service set up for the node"},{"Filter Client":"READY"}]}'
2026-02-10 04:47:54.393 INFO [src.node.waku_node] Node protocols are initialized !!
2026-02-10 04:47:54.394 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:41440/debug/v1/info" -H "Content-Type: application/json" -d 'None'
2026-02-10 04:47:54.399 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'{"listenAddresses":["/ip4/172.18.196.73/tcp/41441/p2p/16Uiu2HAm1fUpketFPEPziG8XV8iy1rkf6ZUroPpCEkGEFrEeinLV","/ip4/172.18.196.73/tcp/41442/ws/p2p/16Uiu2HAm1fUpketFPEPziG8XV8iy1rkf6ZUroPpCEkGEFrEeinLV"],"enrUri":"enr:-L24QOeSUkFG_ly8emftnQaE29Y6T1IMJ__W6KbqErEkFzg1IhEqDXs4YwM3NoymH1_B4Po3SfaDX1qH7GNbDzyGRuMCgmlkgnY0gmlwhKwSxEmKbXVsdGlhZGRyc5YACASsEsRJBqHhAAoErBLESQah4t0DgnJzhQACAQAAiXNlY3AyNTZrMaECXK-jj6QuGvopB1uUA6adGuRHReylZQPQyO2ENDoKPNaDdGNwgqHhg3VkcIKh44V3YWt1MgE"}'
2026-02-10 04:47:54.400 INFO [src.node.waku_node] REST service is ready !!
2026-02-10 04:47:54.400 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:41440/admin/v1/peers" -H "Content-Type: application/json" -d '["/ip4/172.18.244.202/tcp/50806/p2p/16Uiu2HAmGRenh2vB2tFPN7Fh7qA92BNDAF3MYXFCf4EssMVruDtX"]'
2026-02-10 04:47:54.403 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-10 04:47:54.403 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:50805/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2026-02-10 04:47:54.406 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-10 04:47:54.406 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:41440/relay/v1/auto/subscriptions" -H "Content-Type: application/json" -d '["/toychat/2/huilong/proto"]'
2026-02-10 04:47:54.408 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-10 04:47:54.408 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:50805/relay/v1/auto/messages" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/toychat/2/huilong/proto", "timestamp": '$(date +%s%N)'}'
2026-02-10 04:47:54.412 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-10 04:47:54.413 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2026-02-10 04:47:54.514 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2026-02-10 04:47:54.514 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:50805/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2026-02-10 04:47:54.516 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1770698874408853232,"ephemeral":false,"proof":""}]'
2026-02-10 04:47:54.518 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2026-02-10 04:47:54.518 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:41440/relay/v1/auto/messages/%2Ftoychat%2F2%2Fhuilong%2Fproto" -H "Content-Type: application/json" -d 'None'
2026-02-10 04:47:54.520 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/toychat/2/huilong/proto","version":0,"timestamp":1770698874408853232,"ephemeral":false,"proof":""}]'
2026-02-10 04:47:54.522 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:50805/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2026-02-10 04:47:54.524 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-10 04:47:54.525 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:41440/relay/v1/subscriptions" -H "Content-Type: application/json" -d '["/waku/2/rs/2/0"]'
2026-02-10 04:47:54.527 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-10 04:47:54.527 INFO [src.node.api_clients.base_client] curl -v -X POST "http://127.0.0.1:50805/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d '{"payload": "U2hhcmRpbmcgd29ya3MhIQ==", "contentTopic": "/myapp/1/latest/proto", "timestamp": '$(date +%s%N)'}'
2026-02-10 04:47:54.531 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'OK'
2026-02-10 04:47:54.531 DEBUG [src.libs.common] Sleeping for 0.1 seconds
2026-02-10 04:47:54.632 DEBUG [src.steps.sharding] Checking that peer NODE_1:wakuorg/nwaku:latest can find the published message
2026-02-10 04:47:54.632 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:50805/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-10 04:47:54.635 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770698874527853631,"ephemeral":false,"proof":""}]'
2026-02-10 04:47:54.636 DEBUG [src.steps.sharding] Checking that peer NODE_2:wakuorg/nwaku:latest can find the published message
2026-02-10 04:47:54.636 INFO [src.node.api_clients.base_client] curl -v -X GET "http://127.0.0.1:41440/relay/v1/messages/%2Fwaku%2F2%2Frs%2F2%2F0" -H "Content-Type: application/json" -d 'None'
2026-02-10 04:47:54.639 INFO [src.node.api_clients.base_client] Response status code: 200. Response content: b'[{"payload":"U2hhcmRpbmcgd29ya3MhIQ==","contentTopic":"/myapp/1/latest/proto","version":0,"timestamp":1770698874527853631,"ephemeral":false,"proof":""}]'
2026-02-10 04:47:54.641 DEBUG [tests.conftest] Running fixture teardown: test_setup
2026-02-10 04:47:54.642 DEBUG [tests.conftest] Running fixture teardown: close_open_nodes
2026-02-10 04:47:54.642 DEBUG [src.node.waku_node] Stopping container with id dc1168c18386
2026-02-10 04:47:55.126 DEBUG [src.node.waku_node] Container stopped.
2026-02-10 04:47:55.127 DEBUG [src.node.waku_node] Stopping container with id 3d488035f225
2026-02-10 04:47:55.577 DEBUG [src.node.waku_node] Container stopped.
2026-02-10 04:47:55.578 DEBUG [tests.conftest] Running fixture teardown: check_waku_log_errors
2026-02-10 04:47:55.584 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
2026-02-10 04:47:55.589 DEBUG [src.node.docker_mananger] No errors found in the waku logs.
